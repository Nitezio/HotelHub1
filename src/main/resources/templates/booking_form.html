<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>New Booking – Hotel Hub 1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet">
    <!-- your existing styles… -->
</head>
<body>
<nav>
    <a th:href="@{/customer/dashboard}">← Back to Dashboard</a>
</nav>

<main>
    <h2>Choose Your Package & Room</h2>
    <form th:action="@{/customer/booking/confirm}" method="post" id="bookingForm">
        <input type="hidden" name="_csrf" th:value="${_csrf.token}"/>

        <label for="pkg">Package:</label>
        <select id="pkg" name="packageId" class="form-select" required>
            <!-- Iterate packages from the model -->
            <option
                    th:each="pkg : ${packages}"
                    th:value="${pkg.packageId}"
                    th:data-price="${pkg.packagePrice}"
                    th:text="${pkg.packageName}">
            </option>
        </select>

        <label for="room">Room Type:</label>
        <select id="room" name="roomTypeId" class="form-select" required>
            <!-- Iterate roomTypes from the model -->
            <option
                    th:each="rt : ${roomTypes}"
                    th:value="${rt.roomTypeId}"
                    th:data-price="${rt.pricePerNight}"
                    th:text="${rt.typeName}">
            </option>
        </select>

        <label for="cin">Check-In:</label>
        <input type="date" id="cin" name="checkIn"
               class="form-control" required/>

        <label for="cout">Check-Out:</label>
        <input type="date" id="cout" name="checkOut"
               class="form-control" required/>

        <label for="pm">Payment Method:</label>
        <select id="pm" name="paymentMethod" class="form-select" required>
            <option value="CASH">Cash</option>
            <option value="QR">QR</option>
            <option value="CARD">Debit/Credit</option>
        </select>

        <div class="summary">
            Total Cost: <span id="totalCost">0.00</span>
        </div>

        <button type="submit" class="btn btn-gold">Continue & Pay</button>
    </form>
</main>

<script>
    const pkg = document.getElementById('pkg');
    const room = document.getElementById('room');
    const cin = document.getElementById('cin');
    const cout = document.getElementById('cout');
    const total = document.getElementById('totalCost');

    [pkg, room, cin, cout].forEach(el => el.addEventListener('change', updateTotal));

    function updateTotal() {
        const pp = parseFloat(pkg.selectedOptions[0]?.dataset.price || 0);
        const rp = parseFloat(room.selectedOptions[0]?.dataset.price || 0);
        const d1 = new Date(cin.value);
        const d2 = new Date(cout.value);
        const nights = (d2 - d1) / (1000 * 60 * 60 * 24);
        total.textContent = (nights > 0 ? (pp + rp * nights) : 0).toFixed(2);
    }
</script>

<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
</script>
</body>
</html>
